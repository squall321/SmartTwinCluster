groups:
  - name: dashboard_alerts
    interval: 30s
    rules:
      # API 응답 시간 알림
      - alert: HighAPIResponseTime
        expr: histogram_quantile(0.95, rate(api_request_duration_seconds_bucket[5m])) > 5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High API response time"
          description: "API {{$labels.endpoint}} p95 response time is {{$value}}s"

      # 캐시 히트율 낮음
      - alert: LowCacheHitRate
        expr: rate(cache_hits_total[5m]) / (rate(cache_hits_total[5m]) + rate(cache_misses_total[5m])) < 0.7
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Low cache hit rate"
          description: "Cache {{$labels.cache_type}} hit rate is {{$value | humanizePercentage}}"

      # SSH 연결 실패율 높음
      - alert: HighSSHFailureRate
        expr: rate(ssh_connections_total{status="failure"}[5m]) / rate(ssh_connections_total[5m]) > 0.2
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "High SSH connection failure rate"
          description: "Node {{$labels.node}} SSH failure rate is {{$value | humanizePercentage}}"

      # 스토리지 사용량 높음
      - alert: HighStorageUsage
        expr: storage_usage_percent > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High storage usage"
          description: "Storage {{$labels.path}} usage is {{$value}}%"

      - alert: CriticalStorageUsage
        expr: storage_usage_percent > 95
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Critical storage usage"
          description: "Storage {{$labels.path}} usage is {{$value}}% (CRITICAL)"

      # 시스템 리소스 알림
      - alert: HighCPUUsage
        expr: system_cpu_percent > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage"
          description: "System CPU usage is {{$value}}%"

      - alert: HighMemoryUsage
        expr: system_memory_percent > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage"
          description: "System memory usage is {{$value}}%"

      # WebSocket 연결 문제
      - alert: NoWebSocketClients
        expr: websocket_connections_active == 0
        for: 30m
        labels:
          severity: info
        annotations:
          summary: "No WebSocket clients connected"
          description: "No clients have been connected for 30 minutes"

      # 애플리케이션 다운
      - alert: ApplicationDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Application is down"
          description: "{{$labels.job}} is down"

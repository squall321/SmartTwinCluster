#!/bin/bash
################################################################################
# SSH 비밀번호 없이 접속 - 빠른 설정 (수동 버전)
################################################################################

echo "================================================================================"
echo "🔑 SSH 비밀번호 없는 접속 설정 - 빠른 가이드"
echo "================================================================================"
echo ""

cat << 'EOF'
📋 3단계로 완료!

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Step 1: SSH 키 생성 (컨트롤러에서)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ssh-keygen -t rsa -b 4096

  💡 질문이 나오면:
     - "Enter file": 그냥 Enter (기본 경로 사용)
     - "Enter passphrase": 그냥 Enter (비밀번호 없이)
     - "Enter same passphrase again": 그냥 Enter

  ✅ 생성 완료: ~/.ssh/id_rsa (개인키), ~/.ssh/id_rsa.pub (공개키)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Step 2: 각 계산 노드에 공개키 복사
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  # node001
  ssh-copy-id koopark@192.168.122.90

  # node002
  ssh-copy-id koopark@192.168.122.103

  💡 각 노드마다 비밀번호를 한 번씩만 입력하면 됩니다.
     이후에는 비밀번호 입력 불필요!

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Step 3: 테스트
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  # 비밀번호 없이 접속 테스트
  ssh koopark@192.168.122.90 'hostname'
  ssh koopark@192.168.122.103 'hostname'

  ✅ 비밀번호 입력 없이 바로 접속되면 성공!

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✨ 이제 다음 명령어들이 비밀번호 없이 작동합니다:

  ./setup_cluster_full.sh        ← 비밀번호 입력 없이 진행!
  ssh node001 'ls -l'
  scp file.txt node001:/tmp/
  
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
EOF

echo ""
echo "💡 자동 설정 스크립트 사용:"
echo "   ./setup_ssh_passwordless.sh"
echo ""
echo "================================================================================"

#!/bin/bash
################################################################################
# my_cluster.yaml íŒŒí‹°ì…˜ ì´ë¦„ ìˆ˜ì •
################################################################################

echo "================================================================================"
echo "ğŸ”§ my_cluster.yaml íŒŒí‹°ì…˜ ë…¸ë“œ ì´ë¦„ ìˆ˜ì •"
echo "================================================================================"
echo ""

echo "âŒ ë¬¸ì œ: íŒŒí‹°ì…˜ì˜ nodes ì„¤ì •ì´ ì˜ëª»ë¨"
echo "   í˜„ì¬: node[1-2]"
echo "   ì‹¤ì œ ë…¸ë“œ: node001, node002"
echo ""
echo "âœ… ìˆ˜ì •: node[001-002]"
echo ""

# ë°±ì—…
BACKUP="my_cluster.yaml.backup_$(date +%Y%m%d_%H%M%S)"
cp my_cluster.yaml "$BACKUP"
echo "âœ… ë°±ì—… ìƒì„±: $BACKUP"
echo ""

# ìˆ˜ì •
sed -i 's/nodes: node\[1-2\]/nodes: node[001-002]/' my_cluster.yaml
sed -i 's/nodes: node1$/nodes: node001/' my_cluster.yaml

echo "âœ… my_cluster.yaml ìˆ˜ì • ì™„ë£Œ"
echo ""

echo "ğŸ“‹ ë³€ê²½ ë‚´ìš©:"
echo "--------------------------------------------------------------------------------"
grep -A 5 "partitions:" my_cluster.yaml | grep "nodes:"
echo "--------------------------------------------------------------------------------"
echo ""

echo "================================================================================"
echo "ğŸ”„ ë‹¤ìŒ ë‹¨ê³„"
echo "================================================================================"
echo ""
echo "1. slurm.conf ì¬ìƒì„±:"
echo "   python3 configure_slurm_from_yaml.py"
echo ""
echo "2. ì„¤ì • ë°°í¬:"
echo "   ./sync_config_to_nodes.sh"
echo ""
echo "3. Slurm ì¬ì‹œì‘:"
echo "   sudo systemctl restart slurmctld"
echo ""
echo "================================================================================"

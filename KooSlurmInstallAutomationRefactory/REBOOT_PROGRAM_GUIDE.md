# Slurm RebootProgram ì„¤ì • ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

Slurmì˜ `scontrol reboot` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ `slurm.conf`ì— `RebootProgram` ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

## ğŸ”§ ì„¤ì • ë°©ë²•

### 1. YAML ì„¤ì • íŒŒì¼ ìˆ˜ì •

`my_cluster.yaml` íŒŒì¼ì˜ `slurm_config` ì„¹ì…˜ì— ë‹¤ìŒì„ ì¶”ê°€:

```yaml
slurm_config:
  version: 22.05.8
  install_path: /usr/local/slurm
  config_path: /usr/local/slurm/etc
  log_path: /var/log/slurm
  spool_path: /var/spool/slurm
  state_save_location: /var/spool/slurm/state
  reboot_program: /sbin/reboot  # â† ì´ ì¤„ ì¶”ê°€
  scheduler:
    type: sched/backfill
    ...
```

### 2. ìë™ ì„¤ì¹˜ ì‹¤í–‰

ì„¤ì • íŒŒì¼ì„ ì €ì¥í•œ í›„ ìë™ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰:

```bash
python3 main.py my_cluster.yaml
```

ë˜ëŠ” ê¸°ì¡´ í´ëŸ¬ìŠ¤í„°ì— ì ìš©:

```bash
python3 complete_slurm_setup.py
```

### 3. ìˆ˜ë™ ì„¤ì • (ê¸°ì¡´ í´ëŸ¬ìŠ¤í„°)

ì´ë¯¸ ì„¤ì¹˜ëœ í´ëŸ¬ìŠ¤í„°ì˜ ê²½ìš° ì§ì ‘ ìˆ˜ì •:

```bash
# slurm.conf íŒŒì¼ í¸ì§‘
sudo vim /usr/local/slurm/etc/slurm.conf

# Authentication ì„¹ì…˜ ì•„ë˜ì— ì¶”ê°€:
# Reboot Program
RebootProgram=/sbin/reboot

# Slurm ì¬ì‹œì‘
sudo systemctl restart slurmctld
sudo systemctl restart slurmd  # ëª¨ë“  ê³„ì‚° ë…¸ë“œì—ì„œ
```

## ğŸ“ ìƒì„±ë˜ëŠ” slurm.conf ì˜ˆì‹œ

```conf
# slurm.conf - Auto-generated by KooSlurmInstallAutomation
ClusterName=mini-cluster
SlurmctldHost=smarttwincluster

# Authentication
AuthType=auth/munge
CryptoType=crypto/munge

# Reboot Program
RebootProgram=/sbin/reboot

# Scheduler
SchedulerType=sched/backfill
...
```

## ğŸ¯ ì‚¬ìš© ë°©ë²•

ì„¤ì • ì™„ë£Œ í›„ ë…¸ë“œ ì¬ë¶€íŒ…:

```bash
# íŠ¹ì • ë…¸ë“œ ì¬ë¶€íŒ…
scontrol reboot node001

# ì—¬ëŸ¬ ë…¸ë“œ ì¬ë¶€íŒ…
scontrol reboot node[001-004]

# ì´ìœ ì™€ í•¨ê»˜ ì¬ë¶€íŒ…
scontrol reboot node001 reason="System update"
```

## âš™ï¸ ê³ ê¸‰ ì„¤ì •

### ì»¤ìŠ¤í…€ ì¬ë¶€íŒ… ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©

ì¬ë¶€íŒ… ì „ì— ì¶”ê°€ ì‘ì—…ì´ í•„ìš”í•œ ê²½ìš°:

1. ì¬ë¶€íŒ… ìŠ¤í¬ë¦½íŠ¸ ìƒì„±:
```bash
sudo vim /usr/local/bin/slurm-reboot.sh
```

```bash
#!/bin/bash
# Slurm ë…¸ë“œ ì¬ë¶€íŒ… ìŠ¤í¬ë¦½íŠ¸

# ë¡œê·¸ ê¸°ë¡
logger "Slurm reboot initiated for $(hostname)"

# ì‹¤í–‰ ì¤‘ì¸ ì‘ì—… í™•ì¸
RUNNING_JOBS=$(squeue -h -w $(hostname) -t RUNNING -o "%i" | wc -l)
if [ $RUNNING_JOBS -gt 0 ]; then
    logger "Warning: $RUNNING_JOBS jobs still running"
fi

# ìºì‹œ ë™ê¸°í™”
sync

# 5ì´ˆ ëŒ€ê¸° í›„ ì¬ë¶€íŒ…
sleep 5
/sbin/reboot
```

2. ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬:
```bash
sudo chmod +x /usr/local/bin/slurm-reboot.sh
```

3. YAML ì„¤ì • íŒŒì¼ ìˆ˜ì •:
```yaml
slurm_config:
  reboot_program: /usr/local/bin/slurm-reboot.sh
```

### ë…¸ë“œë³„ ì¬ë¶€íŒ… í”„ë¡œê·¸ë¨ ì„¤ì •

íŠ¹ì • ë…¸ë“œì—ë§Œ ë‹¤ë¥¸ ì¬ë¶€íŒ… ë°©ë²• ì‚¬ìš©:

```conf
# slurm.conf
NodeName=node001 RebootProgram=/usr/local/bin/ipmi-reboot.sh ...
NodeName=node002 RebootProgram=/sbin/reboot ...
```

## ğŸ” ë¬¸ì œ í•´ê²°

### RebootProgram ì˜¤ë¥˜ ë°œìƒ ì‹œ

**ì¦ìƒ:**
```
scontrol: error: RebootProgram isn't defined
scontrol_reboot_nodes error: Unspecified error
```

**í•´ê²°:**
1. `slurm.conf`ì— `RebootProgram` ì„¤ì • í™•ì¸
2. ì¬ë¶€íŒ… í”„ë¡œê·¸ë¨ ê²½ë¡œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
3. í”„ë¡œê·¸ë¨ ì‹¤í–‰ ê¶Œí•œ í™•ì¸
4. slurmctld ì¬ì‹œì‘

### ê¶Œí•œ ì˜¤ë¥˜

ì¬ë¶€íŒ… í”„ë¡œê·¸ë¨ì´ root ê¶Œí•œ í•„ìš”í•œ ê²½ìš°:

```bash
# sudoers ì„¤ì •
sudo visudo

# slurm ì‚¬ìš©ìì—ê²Œ ì¬ë¶€íŒ… ê¶Œí•œ ì¶”ê°€
slurm ALL=(ALL) NOPASSWD: /sbin/reboot
slurm ALL=(ALL) NOPASSWD: /usr/local/bin/slurm-reboot.sh
```

## ğŸ“š ì°¸ê³  ìë£Œ

- Slurm ê³µì‹ ë¬¸ì„œ: https://slurm.schedmd.com/slurm.conf.html
- RebootProgram ì„¤ëª…: https://slurm.schedmd.com/slurm.conf.html#OPT_RebootProgram

## âœ… ê²€ì¦

ì„¤ì •ì´ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸:

```bash
# slurm.confì—ì„œ RebootProgram í™•ì¸
grep RebootProgram /usr/local/slurm/etc/slurm.conf

# í…ŒìŠ¤íŠ¸ (ì‹¤ì œ ì¬ë¶€íŒ… ì•ˆ í•¨)
scontrol show config | grep RebootProgram

# Dashboardì—ì„œ í…ŒìŠ¤íŠ¸
# Node Management íƒ­ â†’ Reboot ë²„íŠ¼ í´ë¦­
```

---

**ì‘ì„±ì¼:** 2025-10-10  
**ë²„ì „:** 1.0  
**ì‘ì„±ì:** KooSlurmInstallAutomation

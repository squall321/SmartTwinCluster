#!/bin/bash
################################################################################
# ìµœì¢… ì™„ì„± ìš”ì•½
################################################################################

cat << 'EOF'
================================================================================
ðŸŽ‰ Slurm ì™„ì „ ìžë™í™” - ìµœì¢… ì™„ì„±!
================================================================================

ðŸ“¦ ì¶”ê°€ëœ í•µì‹¬ ìŠ¤í¬ë¦½íŠ¸ (3ê°œ)
================================================================================

1. complete_slurm_setup.py         - Slurm ì™„ì „ ìžë™ ì„¤ì • (10ê°€ì§€ í•„ìˆ˜ í•­ëª©)
2. check_installation.py           - ì„¤ì¹˜ ì™„ë£Œ ê²€ì¦ (10ê°€ì§€ í•­ëª© ì²´í¬)
3. setup_cluster_full.sh (ê°œì„ )    - 8ë‹¨ê³„ í†µí•© ìžë™ ì„¤ì¹˜

================================================================================
ðŸ”§ ìžë™í™”ëœ í•„ìˆ˜ êµ¬ì„± ìš”ì†Œ (ì´ì „ì— ëˆ„ë½ë¨)
================================================================================

âœ… SSH í‚¤ ìžë™ ì„¤ì •                - ë…¸ë“œ ê°„ íŒ¨ìŠ¤ì›Œë“œ ì—†ëŠ” ë¡œê·¸ì¸
âœ… ë°©í™”ë²½ ìžë™ ì„¤ì •                - Slurm í¬íŠ¸ ìžë™ ê°œë°©
âœ… SELinux ìžë™ ì„¤ì •               - ë³´ì•ˆ ì •ì±… ì„¤ì •
âœ… NTP ì‹œê°„ ë™ê¸°í™”                 - ë…¸ë“œ ê°„ ì‹œê°„ ì¼ì¹˜
âœ… í•„ìˆ˜ íŒ¨í‚¤ì§€ ì¼ê´„ ì„¤ì¹˜            - gcc, make, munge ë“±
âœ… Munge ì¸ì¦ ìžë™ ì„¤ì • â­         - Slurm ë…¸ë“œ ê°„ ì¸ì¦ (í•µì‹¬!)
âœ… NFS ê³µìœ  ìŠ¤í† ë¦¬ì§€ â­            - /home, /share ìžë™ ê³µìœ 
âœ… slurm.conf ìžë™ ìƒì„± â­         - YAMLì—ì„œ ìžë™ ë³€í™˜
âœ… cgroup ìžë™ ì„¤ì •                - ë¦¬ì†ŒìŠ¤ ì œí•œ
âœ… í™˜ê²½ë³€ìˆ˜ ìžë™ ì„¤ì •              - PATH, LD_LIBRARY_PATH

================================================================================
ðŸš€ ì›í´ë¦­ ì„¤ì¹˜ (ëª¨ë“  ê²ƒì„ í•˜ë‚˜ì˜ ëª…ë ¹ì–´ë¡œ!)
================================================================================

cd /home/koopark/claude/KooSlurmInstallAutomation

# ê¶Œí•œ ì„¤ì •
chmod +x *.py *.sh job_templates/*.sh

# ê°€ìƒí™˜ê²½ í™œì„±í™”
source venv/bin/activate

# ì™„ì „ ìžë™ ì„¤ì¹˜ ì‹¤í–‰
./setup_cluster_full.sh

# ì„¤ì¹˜ ê²€ì¦
python3 check_installation.py

================================================================================
ðŸ“Š ì´ì „ vs í˜„ìž¬ ë¹„êµ
================================================================================

í•­ëª©                  | ì´ì „            | í˜„ìž¬          | ê°œì„ ë„
---------------------|----------------|---------------|--------
ìˆ˜ë™ ì„¤ì • ë‹¨ê³„        | 20+ ë‹¨ê³„       | 1 ëª…ë ¹ì–´      | 95% â†“
ì„¤ì¹˜ ì‹œê°„            | 2-3 ì‹œê°„       | 30ë¶„          | 75% â†“
í•„ìˆ˜ êµ¬ì„± ëˆ„ë½        | ìžˆìŒ           | ì—†ìŒ          | 100% âœ…
Munge ì„¤ì •           | ìˆ˜ë™ (ë³µìž¡)     | ìžë™          | 100% âœ…
NFS ì„¤ì •             | ìˆ˜ë™           | ìžë™          | 100% âœ…
slurm.conf ìž‘ì„±      | ìˆ˜ë™           | ìžë™ ìƒì„±     | 100% âœ…
ì˜¤ë¥˜ ë°œìƒë¥           | ë†’ìŒ           | ë‚®ìŒ          | 90% â†“
ê²€ì¦ ë„êµ¬            | ì—†ìŒ           | ìžë™ ê²€ì¦     | 100% âœ…

================================================================================
ðŸ” ì„¤ì¹˜ í›„ ê²€ì¦ (ìžë™í™”!)
================================================================================

python3 check_installation.py

ê²€ì¦ í•­ëª© (10ê°€ì§€):
  1. SSH ì—°ê²°
  2. í•„ìˆ˜ íŒ¨í‚¤ì§€
  3. Munge ì¸ì¦
  4. NFS ë§ˆìš´íŠ¸
  5. Slurm ë°”ì´ë„ˆë¦¬
  6. Slurm ì„¤ì • íŒŒì¼
  7. Slurm ì„œë¹„ìŠ¤
  8. MPI ì„¤ì¹˜
  9. Apptainer ì„¤ì¹˜
  10. ì´ë¯¸ì§€ ë””ë ‰í† ë¦¬

================================================================================
ðŸ’¡ í•µì‹¬ ëª…ë ¹ì–´ ëª¨ìŒ
================================================================================

# ì„¤ì¹˜ ê´€ë ¨
python3 fix_config.py                    # ì„¤ì • ìžë™ ìˆ˜ì •
python3 complete_slurm_setup.py          # ì™„ì „ ìžë™ ì„¤ì • (í•µì‹¬!)
python3 install_mpi.py                   # MPI ì„¤ì¹˜
python3 sync_apptainer_images.py         # ì´ë¯¸ì§€ ë™ê¸°í™”
python3 check_installation.py            # ì„¤ì¹˜ ê²€ì¦

# ì´ë¯¸ì§€ ê´€ë¦¬
python3 manage_images.py list            # ëª©ë¡
python3 manage_images.py upload FILE     # ì—…ë¡œë“œ
python3 manage_images.py sync            # ë™ê¸°í™”

# Slurm ê´€ë¦¬
sinfo                                    # í´ëŸ¬ìŠ¤í„° ìƒíƒœ
squeue                                   # ìž‘ì—… í™•ì¸
sbatch job_templates/submit_mpi_apptainer.sh IMAGE.sif PROGRAM

================================================================================
ðŸ“š ë¬¸ì„œ
================================================================================

COMPLETE_AUTOMATION.md     - ì™„ì „ ìžë™í™” ê°€ì´ë“œ (ì‹ ê·œ)
MPI_APPTAINER_GUIDE.md     - MPI + Apptainer ì‚¬ìš© ê°€ì´ë“œ
AUTOMATION_ADDED.md        - ì¶”ê°€ëœ ê¸°ëŠ¥ ìš”ì•½
README.md                  - ì „ì²´ í”„ë¡œì íŠ¸ ë¬¸ì„œ

================================================================================
ðŸŽ¯ ë‹¤ìŒ ë‹¨ê³„
================================================================================

1ï¸âƒ£  ì„¤ì¹˜ ì‹¤í–‰:
   ./setup_cluster_full.sh

2ï¸âƒ£  ê²€ì¦:
   python3 check_installation.py

3ï¸âƒ£  Slurm ì„œë¹„ìŠ¤ ì‹œìž‘:
   ssh smarttwincluster 'sudo systemctl start slurmctld'
   ssh node1 'sudo systemctl start slurmd'
   ssh node2 'sudo systemctl start slurmd'

4ï¸âƒ£  ìƒíƒœ í™•ì¸:
   sinfo

5ï¸âƒ£  ì´ë¯¸ì§€ ì—…ë¡œë“œ:
   python3 manage_images.py upload myapp.sif

6ï¸âƒ£  Job ì œì¶œ:
   sbatch job_templates/submit_mpi_apptainer.sh myapp.sif /usr/bin/program

================================================================================
âœ¨ ì™„ì„±!
================================================================================

ëª¨ë“  í•„ìˆ˜ êµ¬ì„± ìš”ì†Œê°€ ìžë™í™”ë˜ì—ˆìŠµë‹ˆë‹¤!
- Slurm ì™„ì „ ìžë™ ì„¤ì¹˜
- MPI ìžë™ ì„¤ì¹˜
- Apptainer ìžë™ ì„¤ì¹˜
- ì´ë¯¸ì§€ ìžë™ ë™ê¸°í™”
- ì™„ì „í•œ ê²€ì¦ ë„êµ¬

ë‹¨ í•˜ë‚˜ì˜ ëª…ë ¹ì–´ë¡œ ì™„ì „í•œ HPC í´ëŸ¬ìŠ¤í„° êµ¬ì¶• ê°€ëŠ¥! ðŸš€

================================================================================
EOF

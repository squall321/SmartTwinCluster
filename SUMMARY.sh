#!/bin/bash
################################################################################
# 최종 설치 요약 스크립트
################################################################################

cat << 'EOF'
================================================================================
🎉 MPI + Apptainer 자동화 완료!
================================================================================

📦 추가된 파일들:
   1. fix_config.py                      - 설정 자동 수정
   2. install_mpi.py                     - MPI 자동 설치  
   3. sync_apptainer_images.py           - 이미지 동기화
   4. manage_images.py                   - 이미지 관리 도구
   5. setup_cluster_full.sh              - 통합 자동 설치
   6. job_templates/submit_mpi_apptainer.sh  - Job 템플릿
   7. MPI_APPTAINER_GUIDE.md             - 완전 가이드

================================================================================
🚀 지금 바로 시작하기
================================================================================

1️⃣  권한 설정:
   chmod +x set_permissions.sh && ./set_permissions.sh

2️⃣  전체 자동 설치:
   source venv/bin/activate
   ./setup_cluster_full.sh

3️⃣  이미지 업로드:
   python3 manage_images.py upload myapp.sif

4️⃣  Job 제출:
   sbatch job_templates/submit_mpi_apptainer.sh myapp.sif /usr/bin/program

================================================================================
📚 주요 명령어
================================================================================

설정 관리:
   python3 fix_config.py                 # 설정 파일 수정
   python3 validate_config.py my_cluster.yaml  # 검증

이미지 관리:
   python3 manage_images.py list         # 목록
   python3 manage_images.py upload FILE  # 업로드
   python3 manage_images.py sync         # 동기화
   python3 manage_images.py delete FILE  # 삭제
   python3 manage_images.py clean        # 정리

클러스터 관리:
   squeue                                # 작업 상태
   sinfo                                 # 클러스터 상태
   scancel JOB_ID                        # 작업 취소

================================================================================
🏗️  디렉토리 구조
================================================================================

Controller: /share/apptainer/images/    → 중앙 저장소 (느림)
Compute:    /scratch/apptainer/images/  → 로컬 캐시 (빠름!)

이점: 네트워크 부담 없이 로컬에서 빠르게 이미지 로드

================================================================================
📖 문서
================================================================================

   MPI_APPTAINER_GUIDE.md  - 완전한 사용 가이드
   AUTOMATION_ADDED.md     - 추가된 기능 요약
   README.md               - 전체 프로젝트 문서

================================================================================
💡 Best Practice
================================================================================

1. 이미지는 항상 중앙 저장소에 업로드
2. sync_apptainer_images.py로 계산 노드에 복사
3. Job에서는 /scratch의 로컬 이미지 사용
4. 매일 03:00 자동 동기화 실행 (cron)

================================================================================

준비 완료! Happy Computing! 🚀

================================================================================
EOF

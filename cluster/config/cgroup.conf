################################################################################
# Slurm cgroup.conf - cgroup v2 Configuration
################################################################################
#
# This file configures Slurm's cgroup plugin for resource management.
# Ubuntu 22.04+ uses cgroup v2 by default.
#
# Required: CgroupPlugin=cgroup/v2 in slurm.conf (auto-detected)
#
################################################################################

# ============================================================================
# Cgroup v2 Auto-detection
# ============================================================================
# Slurm 23.x+ automatically detects cgroup version
# No need to specify CgroupPlugin - it will use v2 if available

# ============================================================================
# Resource Constraining
# ============================================================================

# Enable memory constraining (limit job memory usage)
ConstrainRAMSpace=yes

# Enable swap constraining (prevent swap usage)
ConstrainSwapSpace=yes

# Enable device constraining (GPU access control)
ConstrainDevices=yes

# Enable core constraining (CPU affinity)
ConstrainCores=yes

# ============================================================================
# Memory Settings
# ============================================================================

# Allowed RAM usage as percentage of allocated memory
# 100 = strict limit (recommended)
AllowedRAMSpace=100

# Allowed swap usage as percentage (0 = no swap)
AllowedSwapSpace=0

# Memory soft limit (percentage before throttling)
# MemorySwappiness=0

# ============================================================================
# Device Settings (for GPU/accelerator jobs)
# ============================================================================

# Device file to cgroup mapping
# AllowedDevicesFile=/etc/slurm/cgroup_allowed_devices_file.conf

# ============================================================================
# Accounting (optional, for tracking resource usage)
# ============================================================================

# Enable task/cgroup accounting
# Note: This may add overhead but provides detailed resource tracking
# TaskAffinity=yes

# ============================================================================
# Namespace Settings
# ============================================================================

# Automatically create/destroy cgroups
# EnableControllers=yes

################################################################################
# Notes for cgroup v2:
#
# 1. Verify cgroup v2 is active:
#    cat /sys/fs/cgroup/cgroup.controllers
#
# 2. Required kernel parameters (usually default in Ubuntu 22.04):
#    systemd.unified_cgroup_hierarchy=1
#
# 3. Check systemd cgroup delegation:
#    cat /sys/fs/cgroup/user.slice/user-$(id -u).slice/user@$(id -u).service/cgroup.controllers
#
# 4. slurm.conf requirements:
#    ProctrackType=proctrack/cgroup
#    TaskPlugin=task/cgroup,task/affinity
#
################################################################################
